---
# Nixobolus - Automated creation of bootable NixOS images
# https://github.com/ponkila/Nixobolus

# Store commonly used values to be referenced later.
variables:
    var_1: &addr 192.168.100.10

# General settings that apply to all machines.
general:
    user: core
    shell: fish
    timezone: Europe/Helsinki
    keymap: fi
    home_manager:
        nix_packages:
            - file
            - tree
            - bind
        programs:
            - tmux
            - htop
            - vim
            - git
    services:
        ssh:
            permit_root_login: false
            password_auth: false
            public_keys:
                - ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNMKgTTpGSvPG4p8pRUWg1kqnP9zPKybTHQ0+Q/noY5+M6uOxkLy7FqUIEFUT9ZS/fflLlC/AlJsFBU212UzobA= ssh@secretive.sandbox.local
                - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKEdpdbTOz0h9tVvkn13k1e8X7MnctH3zHRFmYWTbz9T kari@torque

# Specific configuration for each individual machine. 
hosts:
    - name: muhos
      mounts:
        - source: /dev/disk/by-label/erigon
          target: /var/mnt/erigon
          desc: Erigon Storage
          options:
            - noatime
        - source: /dev/disk/by-label/lighthouse
          target: /var/mnt/lighthouse
          desc: Lighthouse Storage
          options:
            - noatime
      services:
        wireguard:
            interface: dinar
            address: 192.168.100.10/32
            private_key: ENC[AES256_GCM,data:5I6bTwvVKeaSG6ThqVfmOVkbUyHTfwIT0trw0IXWfvFCLi7xZ4VXR58RLTs=,iv:Gl86kSCrYylE9oqpulCaqo6P1BbqhahGwnxplFrDCSM=,tag:nHx7+IzgU9JL8hbYSj9gog==,type:str]
            peers:
                - public_key: ENC[AES256_GCM,data:1V0D8xu3BfYqFqZdY1Rg6upTDYPjyQL6miCOV6KDf97rVf8z19l5yYoak14=,iv:rvL2efWSY1gbn+PKgK2fo1CZPIHrlug4cM61S5MH944=,tag:4NNpDDnf6X5MKoTQmS/dhQ==,type:str]
                  allowed_ips:
                    - 192.168.100.0/24
                  endpoint: ENC[AES256_GCM,data:BaRUW38NesSAN7NAgE4xNac93g==,iv:b1qvmFhUzdV4/QStEj6EEsA6+a9q6l7q7OTAmlY/Sqg=,tag:55QvALhWWGkqifG3Ke3TEw==,type:str]
                  persistent_keepalive: 25
        ethereum:
            network: mainnet
            clients:
                # Execution
                erigon:
                    data_dir: /var/mnt/erigon
                    infra_ip: *addr
                    authrpc_hosts:
                        - '*'
                    authrpc_addr: *addr
                    authrpc_jwtsecret: /var/mnt/erigon/jwt.hex
                    metrics_enable: true
                    externalcl_enable: true
                # Consensus
                lighthouse:
                    data_dir: /var/mnt/lighthouse
                    infra_ip: *addr
                    http_enable: true
                    http_addr: *addr
                    execution_port: 8551
                    execution_endpoint: *addr
                    jwt_secret: /var/mnt/lighthouse/jwt.hex
                    mev_enable: true
                    mev_port: 18550
                    mev_endpoint: *addr
                    slasher_enable: true
                    slasher_history_length: 256
                    slasher_max_db_size: 16
                    prune_payloads_enable: false
                    metrics_enable: true
                    
# Added by SOPS
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2023-03-16T10:23:53Z"
    mac: ENC[AES256_GCM,data:jt+hEk/7lwLWBx8vN8RNCoTTsSLOr+K3HObyumm8dUvv/51TSi0wADuvc8qfqG7qGZW8Jp9CC/6fCXeoOtB8+n0M7vXpEFy8U8RH6n9o2IymrDE2MOZv6FBQSjZWRNvu3T9w8P/WUb9plUA/delqmAOwuhNUp+HrRHwvPtusdCQ=,iv:H2bhIOZHJC48Hae7CBCQqBKdAh99RqqjyuVQWlIf3fU=,tag:ggx1UNyOa2fT12gnHUz52g==,type:str]
    pgp:
        - created_at: "2023-03-16T10:23:51Z"
          enc: |
            -----BEGIN PGP MESSAGE-----

            hQGMA0asU2osiQzOAQv/YRPaf0R3eOWEPXgguaQBpNO+x2osY0QlbC/SRzSFJ3TU
            Lpm+ni9eZiuxLRNr1h7w0GOHrSjQGTVcE0RNuM2NIwH7BwVDaEXYzcO/TL1c9ds8
            CHHMHP/WXw3rwkK3tpQ55VzQvXNe3AZrB1lfu6INiBKWVchB8MgcYgb0xOtpmraL
            itl8eYuGPcXORLx3efP9piMdlaVb4AyFAIYI8F886f1PtAFh32HfwE7+w0j6mHw8
            5hUnosWoGi0aS2DIAoFA/xzDEIqmY7nz2KKgaYNMzTZJ6p0ozG+JPSpBafQqnkBL
            L+K+Cjayr9n2M3uh7OZxjJDZUO2zisf5cOxdPHSz1ms/OzZRKn4wr89fATHPXiwW
            +TZeZowRcX+12V1v502/faHzd/WHtmVDmFuBfxJrCCnPY53O7IfZi8NtKtCkfRY/
            C9sgy/dstEoOz3sJkYqXj5pOcaHleUhs9TIf4L114EoLwEXQFdpzhqI323WDor8v
            7mRp5ij25DXDgGB6pYRr0lwBwilCD8O5iySF5BBpDvGSeH9dr5QKLmPL/xXJ/pCX
            NPk0mgLmzdCedN1+zui8P7Qaw20KqCuCGVJpW0qJdlfLQc3Nref2cmtf8GjpiMSw
            4VYKt/bElnYApezRPA==
            =vEpp
            -----END PGP MESSAGE-----
          fp: 89514318CC412AB3DA074269BF90825A41685E00
    encrypted_regex: ^(public_key|private_key|endpoint)$
    version: 3.7.3
